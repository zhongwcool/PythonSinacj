# 股票数据获取工具集

## 功能介绍

这是一个功能完整的股票数据获取工具集，包含以下主要功能：

### 📊 实时数据获取
- 🔄 每3秒自动请求一次API
- 📊 实时显示请求结果和股票信息
- 📈 统计成功率、失败率、响应时间等指标
- 📝 自动保存详细日志到JSON文件
- 🎯 专门针对深圳股票sz000498（山东路桥）进行测试

### 📈 30分钟分时数据获取
- ⏱️ 支持1、5、15、30、60分钟多种周期
- 🔄 多数据源自动切换（新浪财经、东方财富、腾讯财经）
- 📊 自动数据格式化和统计摘要
- 💾 支持CSV和JSON格式保存
- 🎯 获取历史分钟级K线数据

## 支持的API

### 实时数据API
```
http://hq.sinajs.cn/list=sz000498
```

### 分钟级数据API
- **新浪财经**: `http://money.finance.sina.com.cn/quotes_service/api/json_v2.php/CN_MarketData.getKLineData`
- **东方财富**: `http://push2his.eastmoney.com/api/qt/stock/kline/get`
- **腾讯财经**: `http://ifzq.gtimg.cn/appstock/app/kline/mkline`

## 安装依赖

```bash
pip install -r requirements.txt
```

或者直接安装：

```bash
pip install requests
```

## 使用方法

### 实时数据获取

```bash
python start.py
```

### 30分钟分时数据获取

```bash
# 直接运行分钟数据获取器
python core/minute_data_fetcher.py

# 运行测试脚本
python test_30min_data.py

# 运行使用示例
python example_30min_usage.py
```

### 停止测试

按 `Ctrl+C` 停止测试

## 输出信息

### 实时显示内容

- 📡 测试API地址
- ⏱️ 更新间隔
- 📝 日志文件名
- 📊 最新请求结果（时间、状态、响应时间）
- 📈 股票信息（股票名称、当前价格、涨跌额、涨跌幅、成交量、买一卖一价格和数量、更新时间）
- 📈 统计信息（运行时间、总请求次数、成功次数、失败次数、成功率、失败率、响应时间统计）

### 统计指标

- **成功率**: 成功请求占总请求的百分比
- **失败率**: 失败请求占总请求的百分比
- **平均响应时间**: 所有请求的平均响应时间
- **最快响应时间**: 最快的一次请求响应时间
- **最慢响应时间**: 最慢的一次请求响应时间
- **响应时间中位数**: 响应时间的中位数

## 日志文件

脚本会自动生成带时间戳的JSON日志文件，格式如：`log_20231201_143022.json`

日志文件包含：
- 测试配置信息
- 统计汇总数据
- 每次请求的详细结果

## 示例输出

```
================================================================================
🔍 新浪财经API稳定性测试
================================================================================
📡 测试API: http://hq.sinajs.cn/list=sz000498
⏱️  更新间隔: 3秒
📝 日志文件: log_20231201_143022.json

📊 最新请求结果:
----------------------------------------
时间: 2023-12-01T14:30:25.123456
状态: 成功
响应时间: 156.78ms

📈 股票信息:
  股票名称: 山东路桥
  当前价格: 5.67
  涨跌额: +0.12
  涨跌幅: +2.16%
  今日最高: 5.89
  今日最低: 5.45
  成交量: 1234567
  成交金额: 7890123.000
  买一价: 5.66
  买一量: 123400
  卖一价: 5.67
  卖一量: 98700
  更新时间: 2023-12-01 14:30:22

📈 统计信息:
----------------------------------------
运行时间: 0:05:30
总请求次数: 110
成功次数: 108
失败次数: 2
成功率: 98.18%
失败率: 1.82%
平均响应时间: 145.67ms
最快响应时间: 89.23ms
最慢响应时间: 2345.67ms
响应时间中位数: 134.56ms

💡 按 Ctrl+C 停止测试
================================================================================
```

## 30分钟分时数据获取详细说明

### 功能特点

- **多数据源支持**: 自动在新浪财经、东方财富、腾讯财经之间切换
- **多周期支持**: 支持1、5、15、30、60分钟多种时间周期
- **数据完整性**: 获取历史分钟级K线数据，包含开盘价、最高价、最低价、收盘价、成交量
- **格式灵活**: 支持CSV和JSON两种输出格式
- **统计摘要**: 自动生成数据统计摘要，包含价格区间、成交量统计等

### 使用示例

```python
from core.minute_data_fetcher import MinuteDataFetcher

# 创建数据获取器
fetcher = MinuteDataFetcher()

# 获取30分钟数据
df = fetcher.get_minute_data("sz000498", 30, "auto")

# 打印摘要
fetcher.print_summary(df, "sz000498", 30)

# 保存数据
fetcher.save_to_csv(df, "sz000498", 30)
fetcher.save_to_json(df, "sz000498", 30)
```

### 输出示例

```
📊 sz000498 30分钟分时数据摘要
============================================================
数据条数: 1023
时间范围: 2025-02-05 10:30:00 到 2025-08-08 15:00:00
最新时间: 2025-08-08 15:00:00

📈 最新数据:
  时间: 2025-08-08 15:00:00
  开盘价: 6.07
  最高价: 6.08
  最低价: 6.06
  收盘价: 6.07
  成交量: 3,564,435

📊 统计信息:
  最高价: 6.46
  最低价: 5.35
  平均成交量: 1,494,262
  总成交量: 1,528,630,186
  期间涨跌: +0.38 (+6.68%)
```

## 注意事项

1. 确保网络连接正常
2. 脚本会持续运行直到手动停止
3. 每10次请求会自动保存一次日志
4. 停止测试时会保存最终的完整日志
5. 如果API返回格式发生变化，可能需要调整解析逻辑
6. 分钟级数据获取建议在交易时间内进行，数据更新更及时
7. 不同数据源的数据可能有细微差异，建议使用auto模式自动选择最佳数据源 