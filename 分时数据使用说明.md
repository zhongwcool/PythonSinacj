# 📊 分时数据获取工具使用说明

## 🎯 功能概述

分时数据获取工具支持两种类型的数据：

1. **实时数据** - 当前时刻的股票价格、成交量等信息
2. **分钟数据** - 每分钟的K线数据，包含开盘价、最高价、最低价、收盘价等

## 📁 核心文件

- **`realtime_data_fetcher.py`** - 分时数据获取工具
- **`realtime_example.py`** - 使用示例

## 🚀 快速开始

### 1. 获取实时数据

```python
from realtime_data_fetcher import RealtimeDataFetcher

# 创建数据获取器
fetcher = RealtimeDataFetcher()

# 获取实时数据
realtime_data = fetcher.get_realtime_data("sz000498", 'realtime')

if realtime_data:
    # 显示数据摘要
    fetcher.print_realtime_summary(realtime_data)
    
    # 保存数据
    fetcher.save_to_json(realtime_data, "sz000498")
```

### 2. 获取分钟数据

```python
# 获取1天的分钟数据
minute_df = fetcher.get_minute_data("sz000498", days=1, data_source='auto')

if minute_df is not None:
    # 显示数据摘要
    fetcher.print_minute_summary(minute_df, "sz000498")
    
    # 保存数据
    fetcher.save_to_csv(minute_df, "sz000498")
```

### 3. 运行示例

```bash
# 运行主程序
python realtime_data_fetcher.py

# 运行使用示例
python realtime_example.py
```

## 📊 数据格式

### 实时数据字段

| 字段名 | 说明 |
|--------|------|
| 股票代码 | 股票代码 |
| 股票名称 | 股票名称 |
| 当前价格 | 当前成交价格 |
| 涨跌额 | 相对昨日收盘价的涨跌金额 |
| 涨跌幅 | 相对昨日收盘价的涨跌百分比 |
| 今日开盘 | 今日开盘价 |
| 昨日收盘 | 昨日收盘价 |
| 今日最高 | 今日最高价 |
| 今日最低 | 今日最低价 |
| 成交量 | 今日累计成交量 |
| 成交额 | 今日累计成交金额 |
| 买一价 | 买一价格 |
| 买一量 | 买一数量 |
| 卖一价 | 卖一价格 |
| 卖一量 | 卖一数量 |
| 更新时间 | 数据更新时间 |

### 分钟数据字段

| 字段名 | 说明 |
|--------|------|
| 时间 | 分钟时间戳 |
| 开盘价 | 该分钟开盘价 |
| 最高价 | 该分钟最高价 |
| 最低价 | 该分钟最低价 |
| 收盘价 | 该分钟收盘价 |
| 成交量 | 该分钟成交量 |
| 成交额 | 该分钟成交金额 |
| 振幅 | 该分钟振幅 |
| 涨跌幅 | 该分钟涨跌幅 |
| 涨跌额 | 该分钟涨跌额 |
| 换手率 | 该分钟换手率 |

## 💡 使用场景

### 1. 实时监控
```python
# 实时监控股票价格变化
while True:
    realtime_data = fetcher.get_realtime_data("sz000498", 'realtime')
    if realtime_data:
        print(f"价格: {realtime_data['当前价格']:.2f} ({realtime_data['涨跌幅']:+.2f}%)")
    time.sleep(3)  # 每3秒更新一次
```

### 2. 分时分析
```python
# 获取多天分钟数据进行技术分析
minute_df = fetcher.get_minute_data("sz000498", days=5, data_source='auto')

# 计算移动平均线
minute_df['MA5'] = minute_df['收盘价'].rolling(5).mean()
minute_df['MA10'] = minute_df['收盘价'].rolling(10).mean()
```

### 3. 数据导出
```python
# 导出为CSV文件用于Excel分析
fetcher.save_to_csv(minute_df, "sz000498", "分时数据.csv")

# 导出为JSON文件用于程序处理
fetcher.save_to_json(realtime_data, "sz000498", "实时数据.json")
```

## ⚙️ 配置选项

### 数据源选择
- `data_source='auto'` - 自动选择最佳数据源
- `data_source='sina'` - 使用新浪财经
- `data_source='eastmoney'` - 使用东方财富

### 时间范围
- `days=1` - 获取1天的分钟数据
- `days=5` - 获取5天的分钟数据
- `days=10` - 获取10天的分钟数据

## 📈 数据特点

### 实时数据特点
- ✅ 数据实时性强，延迟低
- ✅ 包含完整的买卖盘信息
- ✅ 适合实时监控和交易决策
- ⚠️ 仅在交易时间内有效

### 分钟数据特点
- ✅ 包含完整的K线信息
- ✅ 适合技术分析和回测
- ✅ 数据历史较长
- ⚠️ 数据量较大，处理需要时间

## 🔧 高级功能

### 1. 多股票批量获取
```python
stock_codes = ["sz000498", "sh000001", "sh600000"]
for stock_code in stock_codes:
    realtime_data = fetcher.get_realtime_data(stock_code, 'realtime')
    if realtime_data:
        print(f"{stock_code}: {realtime_data['当前价格']:.2f}")
```

### 2. 自定义数据保存
```python
# 自定义文件名
filename = f"分时数据_{datetime.datetime.now().strftime('%Y%m%d')}.csv"
fetcher.save_to_csv(minute_df, "sz000498", filename)
```

### 3. 数据质量检查
```python
# 检查数据完整性
if minute_df is not None and not minute_df.empty:
    print(f"数据条数: {len(minute_df)}")
    print(f"时间范围: {minute_df['时间'].min()} 至 {minute_df['时间'].max()}")
    print(f"缺失值: {minute_df.isnull().sum().sum()}")
```

## ⚠️ 注意事项

1. **请求频率**: 避免过于频繁的请求，建议间隔1-3秒
2. **交易时间**: 实时数据仅在交易时间内有效
3. **数据延迟**: 分时数据可能有1-2分钟的延迟
4. **网络环境**: 需要稳定的网络连接

## 📝 输出文件

程序会生成以下文件：

- `sz000498_realtime_data_YYYYMMDD_HHMMSS.json` - 实时数据JSON文件
- `sz000498_minute_data_YYYYMMDD_HHMMSS.csv` - 分钟数据CSV文件

## 🎯 与K线数据工具的区别

| 功能 | K线数据工具 | 分时数据工具 |
|------|-------------|-------------|
| 数据粒度 | 日K线 | 分钟K线 + 实时数据 |
| 更新频率 | 每日更新 | 实时更新 |
| 数据量 | 较小 | 较大 |
| 适用场景 | 长期分析 | 短期监控 |
| 数据源 | 多数据源 | 主要新浪财经 |

---

*更新时间: 2025-08-02* 